<UserControl x:Class="ProcessMonitor.UserControls.ProcessListControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White">
    <Grid
          DataContext="{Binding ProcessListViewModel}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- filtering/sorting -->
        <Grid Grid.Row="0" Background="#F0F0F0" Margin="0">
            <StackPanel Margin="10,10,10,10">
                <TextBlock Text="Filtering options" VerticalAlignment="Center" FontWeight="Bold" Margin="0,0,10,0" />
                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                    <TextBlock Text="PID:" Margin="10,0,3,0" VerticalAlignment="Center"/>
                    <TextBox Text="{Binding FilterPidText, UpdateSourceTrigger=PropertyChanged}"
                             Width="80" Padding="5" BorderThickness="1" BorderBrush="#CCC" />
                    <TextBlock Text="Name:" VerticalAlignment="Center" Margin="15,0,10,0" />
                    <TextBox Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}"
                             Width="150" Padding="5" BorderThickness="1" BorderBrush="#CCC" />
                    <TextBlock Text="Min threads:" VerticalAlignment="Center" Margin="15,0,5,0" />
                    <TextBox Text="{Binding MinThreadsText, UpdateSourceTrigger=PropertyChanged}"
                             Width="60" Padding="3" BorderThickness="1" BorderBrush="#CCC" />
                    <TextBlock Text="Max threads:" VerticalAlignment="Center" Margin="15,0,5,0" />
                    <TextBox Text="{Binding MaxThreadsText, UpdateSourceTrigger=PropertyChanged}"
                             Width="60" Padding="3" BorderThickness="1" BorderBrush="#CCC" />
                    <TextBlock Text="Min memory (MB):" VerticalAlignment="Center" Margin="15,0,5,0" />
                    <TextBox Text="{Binding MinMemoryMbText, UpdateSourceTrigger=PropertyChanged}"
                             Width="80" Padding="3" BorderThickness="1" BorderBrush="#CCC" />
                    <TextBlock Text="Max memory (MB):" VerticalAlignment="Center" Margin="15,0,5,0" />
                    <TextBox Text="{Binding MaxMemoryMbText, UpdateSourceTrigger=PropertyChanged}"
                             Width="80" Padding="3" BorderThickness="1" BorderBrush="#CCC" />
                </StackPanel>
            </StackPanel>
        </Grid>

        <!-- refresh -->
        <Grid Grid.Row="1" Background="#F0F0F0" Margin="0">
            <StackPanel Orientation="Horizontal" Margin="10,10,10,10">
                <Button Command="{Binding RefreshCommand}"
                        Padding="10,5"
                        Background="#0078D4"
                        Foreground="White"
                        Margin="0,0,10,0"
                        Content="Refresh now" />

                <CheckBox IsChecked="{Binding IsAutoRefreshing}" VerticalAlignment="Center" Margin="0,0,10,0">
                    <TextBlock Text="Automatic refresh every " />
                </CheckBox>

                <TextBox Text="{Binding RefreshIntervalMs}" Width="50" Padding="5"
                         BorderThickness="1" BorderBrush="#CCC" Margin="0,0,5,0" />
                <TextBlock Text="ms" VerticalAlignment="Center" />
            </StackPanel>
        </Grid>

        <!-- processes -->
        <DataGrid Grid.Row="2"
                  ItemsSource="{Binding Processes}"
                  SelectedItem="{Binding SelectedProcess}"
                  AutoGenerateColumns="False" CanUserAddRows="False"
                  BorderThickness="1" BorderBrush="#CCC" Margin="0,0,0,0"
                  VirtualizingPanel.IsVirtualizing="True"
                  VirtualizingPanel.VirtualizationMode="Recycling"
                  EnableRowVirtualization="True"
                  EnableColumnVirtualization="True">
            
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Setter Property="ToolTip">
                        <Setter.Value>
                            <ToolTip>
                                <StackPanel>
                                    <TextBlock Text="{Binding IsMonitored, StringFormat='Tracked: {0}'}"/>
                                    <TextBlock Text="{Binding MonitoringStartTime,
                                                      StringFormat='Od: {0:G}'}"/>
                                </StackPanel>
                            </ToolTip>
                        </Setter.Value>
                    </Setter>
                </Style>
            </DataGrid.RowStyle>
            
            
            <DataGrid.Columns>
                <DataGridTextColumn Header="PID" Binding="{Binding ProcessId}" Width="70" />
                <DataGridTextColumn Header="Name" Binding="{Binding ProcessName}" Width="200" />
                <DataGridTextColumn Header="Threads" Binding="{Binding ThreadCount}" Width="70" />
                <DataGridTextColumn Header="Memory (MB)"
                                    Binding="{Binding WorkingSetMb, StringFormat='{}{0:N3}'}"
                                    Width="100" />
                <DataGridTextColumn Header="Priority" Binding="{Binding Priority}" Width="80" />
                <DataGridTextColumn Header="Path" Binding="{Binding ProcessPath}" Width="300" />
            </DataGrid.Columns>
        </DataGrid>

        <!-- actions -->
        <Grid Grid.Row="3" Background="#F0F0F0" Margin="0">
            <StackPanel Orientation="Horizontal" Margin="10,10,10,10">
                <Button
                    Command="{Binding DataContext.StartMonitoringCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                    Padding="10,5"
                    Background="#107C10" Foreground="White" Margin="0,0,10,0">
                    Track process
                </Button>

                <Button Command="{Binding KillProcessCommand}" Padding="10,5"
                        Background="#D13438" Foreground="White" Margin="0,0,10,0">
                    Kill process
                </Button>

                <ComboBox x:Name="PriorityCombo" Width="150" Padding="5" Margin="0,0,10,0">
                    <System:String xmlns:System="clr-namespace:System;assembly=mscorlib">Idle</System:String>
                    <System:String xmlns:System="clr-namespace:System;assembly=mscorlib">BelowNormal</System:String>
                    <System:String xmlns:System="clr-namespace:System;assembly=mscorlib">Normal</System:String>
                    <System:String xmlns:System="clr-namespace:System;assembly=mscorlib">AboveNormal</System:String>
                    <System:String xmlns:System="clr-namespace:System;assembly=mscorlib">High</System:String>
                    <System:String xmlns:System="clr-namespace:System;assembly=mscorlib">RealTime</System:String>
                    
                </ComboBox>

                <Button Command="{Binding SetPriorityCommand}"
                        CommandParameter="{Binding SelectedItem, ElementName=PriorityCombo}"
                        Padding="10,5" Background="#0078D4" Foreground="White">
                    Change priority
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>